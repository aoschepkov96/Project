# Project
## Инструкция
### Перед началом работы необходимо:
1.	Установить Python (при создании была использована версия 3.7, однако более ранние версии должны подойти ( https://www.python.org/downloads/)
2.	Установить Jupyter-Notebook (https://jupyter.org/, либо встроенный в Anaconda (рекомендуется)https://www.anaconda.com/download/). 
3.	Установить MySQL (https://dev.mysql.com/downloads/mysql/, при установке отметить галочкой установку MySQL Connector/ Python.
4.	Обновить команды pip до последней версии (через командную строку с помощью команды python -m pip install --upgrade pip)
5.	Обновить пакет pandas до последней версии (через командную строку с помощью команды pip install --upgrade pandas)
# Блок автоматического импорта в базу данных неструктурированных данных
1. Создать пользователя и БД:
  + Открыть командную строку MySQL Command Line Client
  + Создать нового пользователя: CREATE USER project_user;
  + Создать новую БД: CREATE DATABASE project_db;
  + Предоставить пользователю привилегии на БД: GRANT ALL PRIVILEGES ON project_db.* TO project_user;
  + Обновить привилегии: FLUSH PRIVILEGES;
2.	Скачать папки «анкеты» и «контракты» по ссылке (https://drive.google.com/drive/folders/1VwgP8Vc_RCNAoZK5tWt6aUqdET6cS5vS)
3.	Создайте на своём компьютере папку, присвойте ей какое-либо название на английском языке (далее в инструкции Untitled Folder) и создайте внутри этой папки ещё две папки с названиями: contracts и applications. В папку contracts распакуйте архив с данными по контрактам, а в папку applications распакуйте архив с данными по анкетам кредитных заявок. Важно, чтобы в папках contracts и applications не было никаких подпапок, а сразу находились только файлы с расширением .xlsx). Кроме указанных данных в папках contracts и applications не должно ничего находиться.
4.	Скачайте xls файл с данными по платежам (payments) и поместите в общую папку проекта (Untitled Folder) (https://drive.google.com/open?id=1VwgP8Vc_RCNAoZK5tWt6aUqdET6cS5vS)
5.	Скачайте тетрадку part_1.ipynb и поместите её в созданную вами папку Untitled Folder (https://github.com/kalininiad/Project)
6.	В папке Untitled Folder создайте 4 пустых папки: output_1, output_2, output_3, output_4 (папки для хранения отчетов по каждому блоку заданий) 
7.	Открыть part_1.ipynb с помощью Jupyter Notebook
8.	В четвертой ячейке тетрадки (part_1.ipynb) изменить путь для переменной my_path, в соответствии с тем, куда вы сохранили данные и саму тетрадку.
9.	Запустите весь код с помощью нажатия Cell -> Run All.
## Описание кода
1.	Сначала загружаются данные по анкетам в виде таблиц в Python, таблица  преобразуется (корректируются форматы дат для дальнейшей загрузки в базу данных в единый формат даты, удаляются неотобранные для дальнейшей работы поля); создается таблица applications в базе данных, заполняются данными из таблицы Python. По то самое делается по контрактам, создается таблица contracts, связанная с applications по полю id_number. 
2.	Далее загружается таблица данных по платежам (из payments) и отправляется в базу данных. При подключении к базе данных проверяется правильность загрузки в БД таблицы платежей. В ходе проверки выявлено, что нет контракта 100875, такой платёж не передаётся в базу. 
3.	Все данные таблиц выгружаются в папку output_1  в формате csv.

# Блок анализа и предобработки данных
## Инструкция по запуску кода:
1.	Поместите тетрадку part_2.ipynb в свою общую папку проекта.
2.	В начале тетрадки замените переменные user (имя пользователя) и database (название базы данных) в соответствии с созданной вами базой данных. Также замените переменную my_path в соответствии с путем, по которому расположена ваша общая папка проекта.
3.	Запустите код (Cell -> run all).
4.	Следуйте указаниям прописанным в самом коде.
## Описание кода:
Часть 1. Выявление событий дефолтов
1.	Определяются контракты, удовлетворяющие заданному пользователем горизонту риска, им присваивается флаг {0/1}, характеризующий наличие дефолта.
2.	 В базу данных отправляется соответствующая таблица.
3.	Строится таблица по заявкам, удовлетворяющим заданному пользователем горизонту риска, в которой к имеющимся в заявках данным добавляется флаг {дефолт/недефолт}.
Часть 2. Статистический анализ разделяющей способности переменных
1.	 Пользователю предлагается выбрать любую (категориальную или непрерывную переменную) из таблицы по заявкам, построенной в предыдущей части.
2.	По выбранной переменной строится таблица значений WOE и график (если переменная непрерывная, то предварительно производится разбиение на категории по квантилям).
3.	По выбранной переменной строится ROC-кривая.
4.	Для всех переменных строится график показателя IV.
## Результат выполнения кода:
1.	Создание в БД таблицы contracts_risk_horizon_{0}_months  по контрактам, удовлетворяющим горизонту риска, с данными о номере контракта, дате дефолта, наличии/отсутствии дефолта (флаг {1/0}).
2.	Экспорт в общую папку проекта csv файла с данными по заявкам, удовлетворяющим заданному пользователем горизонту риска, в котором к имеющимся в заявках данным добавлен флаг {дефолт/недефолт}.
3.	Экспорт в общую папку проекта png файлов с графиками (WOE для выбранной пользователем переменной, IV для всех переменных, ROC-кривой для выбранной пользователем переменной).

# Блок присвоения рейтингового балла по переменным.

## Инструкция по запуску кода:
1.	В ячейке 2 прописать имя пользователя и имя БД.
2.	В ячейке 3 прописать путь для сохранения результатов работы кода.
3.	Запустить код (Cell -> run all)

## Описание кода:
Код разделен на несколько частей:
Подготовительная часть.
1.	Загрузка/обновление необходимых библиотек 
2.	Определение пользователя и БД
3.	Выбор пути к данным
Основная часть (присвоение рейтинговых баллов):
1.	Загрузка данных 
•	Составляем таблицу по дефолтам (выгружаем из таблицы платежей номера контрактов, определяем имела ли место просрочка платежей более, чем на 90 дней, присваиваем индекс (1) для дефолтов).
•	Выводим таблицу с основными характеристиками клиентов с дефолтами
2.	Правила обработки информации
•	Каждой категории текстовых полей из таблицы заемщиков присваивается балл на основе показателя WOE.
•	Непрерывные переменные сначала группируются по 25% выборки.

3.	Присвоение рейтинговых баллов
•	Ранжируем категории в каждой переменной по возрастанию WOE
•	Самому низкому WOE назначается балл равный одному - далее по возрастанию WOE каждой категории добавляется три балла
•	Полученные таким образом баллы нормализуются к шкале от 1 до 100: количество баллов конкретной категории делится на сумму уникальных баллов и умножается на 100%

4.	Выгрузка результата в формате .csv (два файла: таблица с баллами по всем контрактам и по дефолтам).


## Результат выполнения кода:
1.	Каждому столбцу характеристик присвоены баллы на основе показателя WOE.
2.	Баллы пронормированы и составлен рейтинг контрактов.
3.	Пользователь имеет возможность выгрузить данные, сформированные скриптом, в формате .csv.

